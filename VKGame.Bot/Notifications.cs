using System;
using System.Threading;
using VKGame.Bot;

namespace VKGame.Bot 
{
    public class Notifications 
    {
        public static bool EnterPaymentCard(int count, long id, string name) 
        {
            var resources = new Api.Resources(id);

            var balance = resources.MoneyCard;
            balance+=count;
            resources.MoneyCard = balance;
            Api.MessageSend($"‚ú® –ü–ª–∞—Ç—ë–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!‚ú®" +
                $"\n" +
                $"\n ‚û° –í–∞–º –ø–æ—Å—Ç—É–ø–∏–ª –ø–ª–∞—Ç—ë–∂ –≤ —Ä–∞–∑–º–µ—Ä–µ {count} üí≥ –æ—Ç: {name}" +
                $"\n üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {resources.MoneyCard}", id);
            return true;
        }

        public static bool MainNotify(string notify)
        {
            Common.Notification = notify;
            return true;
        }

        public static bool SendAllMessage(string text, int count)
        {
            var vk = Common.GetVk();
            int wait = 100;

            if (count > 15) wait = 1500;
            var dialogs = vk.Messages.GetDialogs(new VkNet.Model.RequestParams.MessagesDialogsGetParams
            {
                Count = Convert.ToUInt32(count),
                Offset = 0
            }).Messages;

            foreach(var dialog in dialogs)
            {
                var userId = dialog.UserId;

                Api.MessageSend($"‚ù§ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏!‚ù§" +
                                "\n{text}", userId.Value);
                Thread.Sleep(wait);
            }
            return true;
        }

        public static bool RemovePaymentCard(int count, long id, string name) 
        {
            var resources = new Api.Resources(id);
            var balance = resources.MoneyCard;

            if(balance < count) return false;

            balance -= count;
            resources.MoneyCard = balance;
            Api.MessageSend($"‚ú® –ü–ª–∞—Ç—ë–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!‚ú®" +
                $"\n" +
                $"\n ‚û° –° –í–∞—à–µ–≥–æ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Å—á—ë—Ç–∞ –±—ã–ª–æ —Å–Ω—è—Ç–æ {count} üí≥ –Ω–∞ —Å—á—ë—Ç: {name}" +
                $"\n üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {resources.MoneyCard}", id);
            return true;
        }
    }
}